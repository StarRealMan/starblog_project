title: 简简单单锁相环PLL
date: 2020-04-23 01:20:00
categories: control
tags: []
---
玩过单片机的同学们一定听说过锁相环（PLL）这个东西，就是这个锁相环的倍频作用使得我们能够仅仅使用8MHz或者12MHz的晶振获得几百甚至上千兆Hz的主频。
但是，你是否真的了解锁相环背后的原理？
锁相环除了这样倍频的作用，又有那些其他的作用呢？

今天我们来简简单单地介绍一下锁相环

## 传统意义上的锁相环 ##

百科上这样说：
锁相环通常由鉴相器（PD，Phase Detector）、滤波器（LF，Loop Filter）和压控振荡器（VCO，Voltage Controlled Oscillator）3部分组成前向通路，由分频器组成频率相位的反馈通路，如图所示。
![738b4710b912c8fc470d82a3f8039245d78821e5.jpg][1]
根据锁相环的框图，可以看出，锁相环输入信号与反馈得到的信号送入鉴相器，鉴相器通过比较二者相位，输出相位差送入滤波器，随后滤波器输出控制压控振荡器来产生一定频率的信号。本质上讲，这就是一个反馈控制系统，鉴相器输出相位差如果构成负反馈的话，这个系统就能使输出信号平稳跟踪输入信号，二者频率是相同的。
那锁相环又是如何做到倍频的呢？

还是利用自动控制原理的知识来解释，如果我们反馈输出信号的本身，由于系统想要收敛使得误差为0，那么系统输出信号就会跟随输入信号；但当我们反馈输出信号的N分频，系统还想要收敛使得误差为0，这时反馈信号会跟随输入信号，最终的输出信号就会变成输入信号的N倍频。直接分频是很容易做到的，但直接倍频却很难，我们通过一个简单的反馈控制系统和分频器就实现了一个倍频器，这就是控制理论的魅力所在。

了解了锁相环倍频的原理，大家会不会提出一个疑问，就是为什么锁相环不能有非整数的倍频？其实这是因为锁相环处理反馈的鉴相器是通过比较两个信号的相位来计算误差的，而并不是比较频率（个人认为比较频率是很难实现的），非整数倍频就需要非整数分频，这可能会导致相位差不能收敛使得系统失控，只有整数倍频率能够使得相位差收敛至0。

## 锁相环的妙用 ##

锁相环除了能够实现平稳跟踪信号频率，倍频，还有其他的妙用：
在电机无传感器估计电角度时，我们通过扩张状态观测器可以观测到α、β两相的反电动势大小，到了这一步该如何获得电角度呢？最简单的方法大家可能已经知道了，就是反三角函数法，直接使用arctan函数即可计算得到对应的电角度。
但由于观测器参数设置等原因，可能导致电角度不平滑，使得矢量控制不平滑，电机性能下降。这时可以虚拟一个电角度，
![Snipaste_2020-04-23_11-31-33.png][2]
使这个电角度跟踪通过观测得到的电角度，可以使电角度得到平滑，如下图：
![Snipaste_2020-04-23_09-54-28.png][3]
这里通过ΔE来确定θ_hat向目标收敛的速度，也就是ω。
不仅是观测器可以利用这种方法使角度收敛，高频注入法也可以使用锁相环获得角度。

本质上讲，锁相环相当于一个低通滤波器！

  [1]: http://www.starydy.xyz/usr/uploads/2020/04/2133134256.jpg
  [2]: http://www.starydy.xyz/usr/uploads/2020/04/691379040.png
  [3]: http://www.starydy.xyz/usr/uploads/2020/04/4102771430.png